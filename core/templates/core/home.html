{% extends "core/base.html" %}
{% load humanize %} {# Carrega 'humanize' para usar filesizeformat #}

{% block title %}Página Inicial{% endblock %}

{% block content %}
<h1>Página Inicial</h1>

{% if user.is_authenticated %}
    <p>Olá, <strong>{{ user.username }}</strong>! Bem-vindo(a) ao sistema.</p>
    <hr>

    {# --- Seção para exibir os backups do S3 --- #}
    <h2><i class="fas fa-hdd"></i> Backups no Bucket S3: ({{ s3_bucket_name }})</h2> {# Mostra o nome do bucket #}

    {% if s3_error %} {# Se ocorreu um erro na view #}
        <div style="padding: 15px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 5px; margin-bottom: 15px;">
            <strong>Erro ao consultar S3:</strong> {{ s3_error }}
        </div>
    {% else %} {# Se não houve erro, tenta exibir a lista #}
        {% if backups %} {# Se a lista de backups não está vazia #}
            <ul style="list-style-type: none; padding: 0;">
                {% for backup in backups %}
                    <li style="background-color: #e9ecef; margin-bottom: 5px; padding: 8px 12px; border-radius: 4px;">
                        <strong>{{ backup.filename }}</strong><br>
                        <small>
                            Tamanho: {{ backup.size|filesizeformat }} |
                            Modificado: {{ backup.last_modified|date:"d/m/Y H:i:s" }}
                        </small>
                    </li>
                {% endfor %}
            </ul>
        {% else %} {# Se a lista de backups está vazia #}
            <p>Nenhum arquivo de backup encontrado no bucket com o padrão 'AB_CADASTROPOSITIVO_*.bak'.</p>
        {% endif %}
    {% endif %}
    {# --- Fim da seção de backups --- #}

    <hr>

    {# Formulário de Logout #}
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit">Sair (Logout)</button>
    </form>

{% else %}
    <p>Você não está logado.</p>
    <p><a href="{% url 'login' %}">Fazer Login</a></p>
{% endif %}

{% endblock %}